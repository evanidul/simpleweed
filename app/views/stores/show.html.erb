
<% content_for :head do %>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type='text/javascript' src='https://www.google.com/jsapi'></script>
<script type='text/javascript'>
	google.load('visualization', '1', {packages:['table']});
	// google.setOnLoadCallback(drawTable);


</script>	
<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
<!-- <link rel="stylesheet" href="http://jqueryui.com/resources/demos/style.css"> -->
<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
 
<% end %>

<div class="row">
	<!-- left, main section -->
    <div class="col-md-8">
		<h1 id="name"><%= @store.name %></h1>      
		<div id="review-controls">
			<!-- pro coding right here -->
			<div class="star-rank">
				<%= image_tag("yellowstar.jpeg", size:"20", class: "star-image") %>
				<%= image_tag("yellowstar.jpeg", size:"20", class: "star-image") %>
				<%= image_tag("yellowstar.jpeg", size:"20", class: "star-image") %>
				<%= image_tag("yellowstar.jpeg", size:"20", class: "star-image") %>
				<%= image_tag("yellowstar.jpeg", size:"20", class: "star-image") %>
				<%= image_tag("yellowstar.jpeg", size:"20", class: "star-image") %>
				<%= image_tag("yellowstar.jpeg", size:"20", class: "star-image") %>
				<%= image_tag("yellowstar.jpeg", size:"20", class: "star-image") %>
				<%= image_tag("yellowstar.jpeg", size:"20", class: "star-image") %>
				<%= image_tag("yellowstar.jpeg", size:"20", class: "star-image") %>
			</div>
			<div class="reviews-link">
				Reviews (100)
			</div>	

			<div class="write-review-button">
				<%= link_to 'Write a Review', store_path(@store), class: 'btn btn-primary' , id: "write-review-button" %>
			</div>	
		</div>
		<p id="description">
			He moonlight difficult engrossed an it sportsmen. Interested has all devonshire difficulty gay assistance joy. Unaffected at ye of compliment alteration to. Place voice no arise along to. Parlors waiting so against me no. Wishing calling are warrant settled was luckily. Express besides it present if at an opinion visitor. 

			She wholly fat who window extent either formal. Removing welcomed civility or hastened is. Justice elderly but perhaps expense six her are another passage. Full her ten open fond walk not down. For request general express unknown are. He in just mr door body held john down he. So journey greatly or garrets. Draw door kept do so come on open mean. Estimating stimulated how reasonably precaution diminution she simplicity sir but. Questions am sincerity zealously concluded consisted or no gentleman it. 

			Nor hence hoped her after other known defer his. For county now sister engage had season better had waited. Occasional mrs interested far expression acceptance. Day either mrs talent pulled men rather regret admire but. Life ye sake it shed. Five lady he cold in meet up. Service get met adapted matters offence for. Principles man any insipidity age you simplicity understood. Do offering pleasure no ecstatic whatever on mr directly. 
		</p>	

		<% if  @store.firsttimepatientdeals && !@store.firsttimepatientdeals.empty?  %>
			<h4>First Time Patient Deals </h4>
			<p id="first-time-patient-deals">
				<%= raw @store.firsttimepatientdeals %>
			</p>
		<% end %>

		<h3>Menu</h3>
		<%= link_to 'Edit Menu', store_store_items_path(@store), class: 'btn btn-primary' , id: "edit_store_items" , 'data-no-turbolink' => true %>

		
		</br></br>
		<div id="accordion">			
			<% @grouped_store_items.each do |category, store_items| %>
  			<h3><%= category %></h3>
  			<div> <!-- empty div required for jquery accordion -->
  				
  				<div id="table_<%= category %>" ></div>

<script>
	(function drawTable() {
	  var data = new google.visualization.DataTable();
	  data.addColumn('string', 'Name');
	  data.addColumn('string', 'Category');
	  data.addColumn('string', '1g');
	  data.addColumn('string', '1/8');
	  data.addColumn('string', '1/4');
	  data.addColumn('string', '1/2');
	  data.addColumn('string', '1 oz');
      
        <% store_items.each do |store_item| %>
    data.addRow(['<%= store_item.name %>',   
     '<%= store_item.category %>',
     '<%= store_item.costonegram %>',
     
     '<%= store_item.costeighthoz %>',
     '<%= store_item.costquarteroz %>',
     '<%= store_item.costhalfoz %>',
     '<%= store_item.costoneoz %>']);
  <% end %>      


      var table = new google.visualization.Table(document.getElementById("table_<%= category %>"));
      
 	  var cssClassNames = {headerRow: "simple-weed-google-table-header", headerCell: 'simple-weed-google-table-header-cell',};
      table.draw(data, {showRowNumber: false, allowHtml: true, cssClassNames: cssClassNames});
      
      
      google.visualization.events.addListener(table, 'sort', setWidth);
      setWidth();
	})();

	function setWidth() {
	  var title = "Name";
      var width = "400px";
      $('.google-visualization-table-th:contains(' + title + ')').css('width', width);
	}
</script>

		
			
			
			</div>	
		
		<% end %>

		</div> <!-- accordion -->
		  <script>
		  $(function() {

		    $( "#accordion" ).accordion({
		      heightStyle: "content", //allows divs to be different height.  Very important
		      collapsible: true, 	//allows all elements to be collabsible		      
		    });
		  });
  		</script>


    </div> <!-- end of left container -->

    <!-- right, side bar -->
    <div class="col-md-4">
        <div class="store-map-loc">
		
		<div id="gmap_canvas"></div>
		
		<script type="text/javascript">

  			function codeAddress() {
				    //In this case it gets the address from an element on the page, but obviously you  could just pass it to the method instead

				    geocoder = new google.maps.Geocoder();
				    //var address = "7110 Rock Valley Court, San Diego, CA 92122";
				    var address = "<%= escape_javascript @store.address %>";

				    geocoder.geocode( { 'address': address}, function(results, status) {
				      if (status == google.maps.GeocoderStatus.OK) {
				        //In this case it creates a marker, but you can get the lat and lng from the location.LatLng
				        console.log(results[0].geometry.location);
						var myOptions = {
							zoom:15,
							center: new google.maps.LatLng(results[0].geometry.location),
							mapTypeId: google.maps.MapTypeId.ROADMAP
						}
				        map = new google.maps.Map(document.getElementById("gmap_canvas"), myOptions);
				        map.setCenter(results[0].geometry.location);
				        var marker = new google.maps.Marker({
				            map: map, 
				            position: results[0].geometry.location,				            
				        });
				        
						// infowindow = new google.maps.InfoWindow
						// 	({
						// 		content:"<span class='gmap'><%= @store.name  %></span>" 
						// 	});
						// google.maps.event.addListener(marker, "click", function(){infowindow.open(map,marker);});
	
						// infowindow.open(map,marker);

						
				      } else {
				        alert("Geocode was not successful for the following reason: " + status);
				      }
				    });
				  }
			google.maps.event.addDomListener(window, "load", codeAddress);
			
		</script>
		</div>
		<!-- end of google maps -->
		<div id="contact">
			<h3>Contact</h3>
			<address>
				<strong><%= @store.name  %></strong><br>
				<%= @store.addressline1  %><br>
				<% if  @store.addressline2 && !@store.addressline2.empty?  %>
					<%= @store.addressline2  %><br>
				<% end %>	
				<%= @store.city  %>, <%= @store.state  %> <%= @store.zip  %><br>
				 
				 <abbr title="Phone">P:</abbr> <%= @store.phonenumber  %><br>
			</address>
		</div>

		<h3>Debug</h3>
		 <%= @timezone %><br>
		 <%= @currenttime %><br>
		 <%= @secondsSinceMidnight %><br>
		 <%= @day %><br>
		 <%= @debug %><br>
		 Open: <%= @store.storehourssundayopen %><br>
		 Close: <%= @store.storehourssundayclosed %><br>
		<%= @store.storehoursfridayopen%>		<%= @store.storehoursfridayclosed %> <br>
		is open? <%= @is_open %>

		<script type="text/javascript">
			
			$( document ).ready(function() {
				var isStoreOpen = <%= @is_open %>;				
				var dayInt = "<%= @dayint %>";
				if ( isStoreOpen ) {
					setStoreStatus(dayInt , "Open now", "green");
				} else {
					setStoreStatus(dayInt, "Closed now", "red");
				}  
			});

			function setStoreStatus(dayint, status, color) {
				var idPrefix = "store-status-";
				var divid = idPrefix + dayint;				
				var selector = "#" + divid ;
				$(selector).html(status);				
				$(selector).addClass(color)
			}

		</script>
		<h3>Hours</h3>
		<table id="storehours">
			
			<tr>
				<td class="day">Sunday</td>
				<td><%= @store.storehourssunday %></td>
				<td id="store-status-0"></td>
			</tr>				
				<td class="day">Monday</td>
				<td><%= @store.storehoursmonday %></td>
				<td id="store-status-1"></td>
			</tr>
			<tr>
				<td class="day">Tuesday</td>
				<td><%= @store.storehourstuesday %></td>
				<td id="store-status-2"></td>
			</tr>
			<tr>
				<td class="day">Wednesday</td>
				<td><%= @store.storehourswednesday %></td>
				<td id="store-status-3"></td>
			</tr>
			<tr>
				<td class="day">Thursday</td>
				<td><%= @store.storehoursthursday %></td>
				<td id="store-status-4"></td>
			</tr>
			<tr>
				<td class="day">Friday</td>
				<td><%= @store.storehoursfriday %></td>
				<td id="store-status-5"></td>
			</tr>
			<tr>
				<td class="day">Saturday</td>
				<td><%= @store.storehourssaturday %></td>
				<td id="store-status-6"></td>
			</tr>
		</table>

		<h3>Daily Specials</h3>
		<table id="dailyspecials">
			<tr>
				<td class="day">Sunday</td>
				<td><%= @store.dailyspecialssunday %></td>
			</tr>		
			<tr>
				<td class="day">Monday</td>
				<td><%= @store.dailyspecialsmonday %></td>
			</tr>
			<tr>
				<td class="day">Tuesday</td>
				<td><%= @store.dailyspecialstuesday %></td>
			</tr>
			<tr>
				<td class="day">Wednesday</td>
				<td><%= @store.dailyspecialswednesday %></td>
			</tr>
			<tr>
				<td class="day">Thursday</td>
				<td><%= @store.dailyspecialsthursday %></td>
			</tr>
			<tr>
				<td class="day">Friday</td>
				<td><%= @store.dailyspecialsfriday %></td>
			</tr>
			<tr>
				<td class="day">Saturday</td>
				<td><%= @store.dailyspecialssaturday %></td>
			</tr>
		</table>
		<h3>Dispensary Features</h3>
		<table id="dispensaryfeatures">
			<tr>
				<td>Accepts Credit/Debit cards</td>
				<td><%= check_box_tag :acceptscreditcards , 1 , @store.acceptscreditcards ? true : false, disabled: true %></td>
			</tr>
			<tr>
				<td>ATM Access</td>
				<td><%= check_box_tag :atmaccess , 1 , @store.atmaccess ? true : false, disabled: true %></td>
			</tr>
			<tr>
				<td>Automatic Dispensing Machines</td>
				<td><%= check_box_tag :automaticdispensingmachines , 1 , @store.automaticdispensingmachines ? true : false, disabled: true %></td>
			</tr>
			<tr>
				<td>Delivery Service</td>
				<td><%= check_box_tag :deliveryservice , 1 , @store.deliveryservice ? true : false, disabled: true %></td>
			</tr>
			<tr>
				<td>First Time Patient Deals</td>
				<td><%= check_box_tag :firsttimepatientdeals , 1 , @store.firsttimepatientdeals ? true : false, disabled: true %></td>
			</tr>
			<tr>
				<td>Handicap Access</td>
				<td><%= check_box_tag :handicapaccess , 1 , @store.handicapaccess ? true : false, disabled: true %></td>
			</tr>
			<tr>
				<td>Lounge Area</td>
				<td><%= check_box_tag :loungearea , 1 , @store.loungearea ? true : false, disabled: true %></td>
			</tr>
			<tr>
				<td>Pet Friendly</td>
				<td><%= check_box_tag :petfriendly , 1 , @store.petfriendly ? true : false, disabled: true %></td>
			</tr>
			<tr>
				<td>Security Guard</td>
				<td><%= check_box_tag :securityguard , 1 , @store.securityguard ? true : false, disabled: true %></td>
			</tr>			
		</table>
    </div><!-- end right, side bar -->
</div> <!-- end of 'row' -->


